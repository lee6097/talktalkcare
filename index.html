<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í†¡í†¡ì¼€ì–´ (TalkTalkCare)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      text-align: center;
      font-size: 2em;
      margin-bottom: 10px;
      color: #0078d7;
    }

    .description {
      max-width: 700px;
      font-size: 0.95em;
      color: #333;
      background: #ffffffdd;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 0 8px #ddd;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    #chatbox {
      width: 100%;
      max-width: 600px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px #ccc;
    }

    #chat {
      display: flex;
      flex-direction: column;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 10px;
    }

    .bubble-container {
      display: flex;
      align-items: flex-start;
      margin: 8px 0;
    }

    .bubble {
      padding: 10px 14px;
      border-radius: 10px;
      max-width: 80%;
      word-wrap: break-word;
    }

    .user {
      background: #d1e7ff;
      align-self: flex-end;
      margin-left: auto;
    }

    .ai {
      background: #eee;
      align-self: flex-start;
      margin-right: auto;
    }

    #inputForm {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    #userInput {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: #0078d7;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #005fa3;
    }

    .reset-btn {
      margin-top: 15px;
      background: #888;
    }

    .reset-btn:hover {
      background: #666;
    }

    .copy-btn {
      font-size: 7px; /* ë” ì‘ê²Œ */
      padding: 2px 4px;
      background: transparent;
      color: #666;
      border: 1px solid #ccc;
      border-radius: 4px;
      position: absolute;
      opacity: 0.6;
      cursor: pointer;
    }

    .copy-btn:hover {
      background: #eee;
      opacity: 1;
    }

    .allcopy-btn {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: #0078d7;
      color: white;
      cursor: pointer;
      margin-top: 10px;
    }

    .allcopy-btn:hover {
      background: #005fa3;
    }

    .allcopy-btn:focus {
      outline: none;
    }

    .bubble-wrapper {
      position: relative;
      display: inline-block;
      max-width: 80%;
    }

    .bubble-wrapper.user .copy-btn {
      left: 0;
      bottom: -20px;
    }

    .bubble-wrapper.ai .copy-btn {
      right: 0;
      bottom: -20px;
    }
  </style>
</head>
<body>
  <h1>í†¡í†¡ì¼€ì–´ (TalkTalkCare)</h1>
  <div class="description">
    í†¡í†¡ì¼€ì–´(TalkTalkCare)ëŠ” OpenAI ê¸°ë°˜ì˜ ì˜í•™ ìƒë‹´ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. ì˜í•™ê³¼ ê´€ë ¨ëœ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì œì‹œí•˜ê³ , ì ì ˆí•œ ì§„ë£Œê³¼ë¥¼ ì¶”ì²œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
    ì±„íŒ…ì°½ì— í˜„ì¬ ê°€ì¥ ë¶ˆí¸í•œ ì¦ìƒì„ ì…ë ¥í•˜ê±°ë‚˜, ë˜ëŠ” ê¶ê¸ˆí•œ ì˜í•™ì§€ì‹ì— ëŒ€í•´ ë¬¼ì–´ë³´ì‹œë©´ AI ë¹„ì„œê°€ ìƒë‹´í•´ë“œë¦½ë‹ˆë‹¤.<br><br>
    ë‹¤ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ ì˜ ì•Œë ¤ì§„ ì˜í•™ì§€ì‹ì„ ë°”íƒ•ìœ¼ë¡œ ë…¼ë¦¬ì  ë‹µë³€ì„ ì œì‹œí•  ë¿ ì§„ë£Œë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ê°€ ì•„ë‹ˆë©°, ë‹µë³€ì— ëŒ€í•´ ì±…ì„ì§€ì§€ë„ ì•ŠìŠµë‹ˆë‹¤. ì˜í•™ì  íŒë‹¨, ì§„ë‹¨, ì§„ì°°, ì²˜ë°©ì„ í•  ìˆ˜ ì—†ìœ¼ë©°, ì •í™•í•œ ì§„ë‹¨ê³¼ ì¹˜ë£Œë¥¼ ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ ì˜ë£Œê¸°ê´€ì„ ë°©ë¬¸í•˜ì—¬ ì˜ë£Œ ì „ë¬¸ê°€ì˜ ì§„ë£Œë¥¼ ë°›ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤.<br><br>
    ë˜í•œ ì´ ì±—ë´‡ì€ ì–´ë– í•œ ì •ë³´ë„ ì €ì¥ ë° ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë¯¼ê°í•œ ê±´ê°•ì •ë³´ëŠ” ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ì…ë ¥ì„ ì‚¼ê°€ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
  </div>

  <div id="chatbox">
    <div id="chat"></div>
    <form id="inputForm">
      <input type="text" id="userInput" placeholder="í˜„ì¬ ë¶ˆí¸í•œ ì¦ìƒ ë˜ëŠ” ê¶ê¸ˆí•œ ì˜í•™ì§€ì‹ì„ ì…ë ¥í•˜ì„¸ìš”." />
      <button type="submit">ë³´ë‚´ê¸°</button>
    </form>
    <button class="reset-btn" onclick="location.reload()">ğŸ”„ ëŒ€í™” ì´ˆê¸°í™”</button>
    <button class="allcopy-btn" onclick="copyAll()">ğŸ“ ì „ì²´ ë³µì‚¬</button>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('inputForm');
    const userInput = document.getElementById('userInput');

    const messages = [
      { role: "system", content: "ë„ˆëŠ” ê³µê°ëŠ¥ë ¥ ë†’ì€ ìƒëƒ¥í•œ ì„±ê²©ì˜ ê±´ê°• ì •ë³´ ìƒë‹´ì‚¬ì•¼..." } // system prompt ì¶•ì•½
    ];

    form.onsubmit = async (e) => {
      e.preventDefault();
      const text = userInput.value.trim();
      if (!text) return;

      appendBubble(text, 'user');
      messages.push({ role: 'user', content: text });
      userInput.value = '';
      userInput.disabled = true;

      appendBubble('â³ ë‹µë³€ ì‘ì„± ì¤‘... ìµœëŒ€ 1ë¶„ê¹Œì§€ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'ai');

      try {
        const res = await fetch('https://talktalkcare-server.onrender.com/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messages })
        });

        const data = await res.json();
        removeLastBubble();
        messages.push({ role: 'assistant', content: data.reply });
        appendBubble(data.reply, 'ai');
      } catch (err) {
        removeLastBubble();
        appendBubble('âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.', 'ai');
      } finally {
        userInput.disabled = false;
        userInput.focus();
      }
    };

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.appendChild(document.createTextNode(text));
      return div.innerHTML.replace(/\n/g, "<br>");
    }

    function appendBubble(text, sender) {
      const container = document.createElement('div');
      container.className = 'bubble-container';

      const bubble = document.createElement('div');
      bubble.className = `bubble ${sender}`;
      bubble.innerHTML = escapeHtml(text);

      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.textContent = 'ğŸ“‹ ë³µì‚¬';
      copyBtn.onclick = () => copyToClipboard(text);

      container.appendChild(bubble);
      container.appendChild(copyBtn);

      chat.appendChild(container);
      chat.scrollTop = chat.scrollHeight;
    }

    function removeLastBubble() {
      const last = chat.lastElementChild;
      if (last) chat.removeChild(last);
    }

    function copyToClipboard(text) {
      const temp = document.createElement('textarea');
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand('copy');
      document.body.removeChild(temp);
    }

    function copyAll() {
      let allMessages = '';
      const bubbles = document.getElementsByClassName('bubble');
      for (let bubble of bubbles) {
        allMessages += bubble.innerText + '\n';
      }
      copyToClipboard(allMessages.trim());
    }
  </script>

  <!-- ê´€ë¦¬ì ë²„íŠ¼ (ìˆ¨ê¹€ ì²˜ë¦¬) -->
  <button onclick="openAdmin()" style="display:none;" id="adminBtn">ğŸ“Š ê´€ë¦¬ì í˜ì´ì§€</button>
  <script>
    // document.getElementById('adminBtn').style.display = 'block';
    async function openAdmin() {
      const password = prompt("ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
      const res = await fetch(`https://talktalkcare-server.onrender.com/admin?password=${encodeURIComponent(password)}`);
      if (res.ok) {
        const data = await res.json();
        alert(`ğŸ“Š í˜ì´ì§€ ì¡°íšŒìˆ˜: ${data.pageViews}\nğŸ’¬ ë©”ì‹œì§€ ìˆ˜: ${data.messageCount}`);
      } else {
        alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
      }
    }
  </script>

  <script>
    fetch('https://talktalkcare-server.onrender.com/view');
  </script>
</body>
</html>
