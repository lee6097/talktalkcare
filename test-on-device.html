<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Device Speech Recognition Test</title>
    <style>
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; }
        .main { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #micBtn { font-size: 3rem; width: 80px; height: 80px; border-radius: 50%; border: 1px solid #ccc; }
        #result { margin-top: 20px; font-size: 1.5rem; color: #333; padding: 0 20px; }
        #log-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 150px; background: #111; color: #0f0; font-family: monospace; font-size: 12px; overflow-y: scroll; border-top: 2px solid #333; box-sizing: border-box; padding: 5px; }
    </style>
</head>
<body>
    <div class="main">
        <button id="micBtn">ğŸ¤</button>
        <p id="result">ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë§í•˜ì„¸ìš”.</p>
    </div>
    <div id="log-container"></div>

    <script>
        const micBtn = document.getElementById('micBtn');
        const resultP = document.getElementById('result');
        const logContainer = document.getElementById('log-container');

        // í™”ë©´ì— ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ëŠ” 'ë¸”ë™ë°•ìŠ¤' í•¨ìˆ˜
        function log(message) {
            const now = new Date();
            const time = now.toTimeString().split(' ')[0] + '.' + now.getMilliseconds();
            logContainer.innerHTML += `[${time}] ${message}<br>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        log('Page loaded. Initializing...');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            log('SpeechRecognition API is available.');
            const recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';

            let isListening = false;

            micBtn.addEventListener('click', () => {
                log('Mic button clicked.');
                try {
                    if (isListening) {
                        log('Stopping recognition...');
                        recognition.stop();
                    } else {
                        log('Starting recognition...');
                        recognition.start();
                    }
                } catch (e) {
                    log(`ERROR in click handler: ${e.name} - ${e.message}`);
                }
            });

            // ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ê°ì‹œí•˜ì—¬ ë¡œê·¸ë¡œ ë‚¨ê¹ë‹ˆë‹¤.
            recognition.onstart = () => {
                log('EVENT: onstart - Recognition has started.');
                isListening = true;
                micBtn.textContent = 'â¹ï¸';
                resultP.textContent = 'ë“£ê³  ìˆì–´ìš”...';
            };
            
            recognition.onend = () => {
                log('EVENT: onend - Recognition has ended.');
                isListening = false;
                micBtn.textContent = 'ğŸ¤';
                resultP.textContent = 'ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë§í•˜ì„¸ìš”.';
            };
            
            recognition.onerror = (event) => {
                log(`EVENT: onerror - ERROR DETECTED!`);
                log(`Error type: ${event.error}`);
                log(`Error message: ${event.message}`);
                resultP.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${event.error}`;
            };
            
            recognition.onsoundstart = () => log('EVENT: onsoundstart - Sound detected.');
            recognition.onspeechstart = () => log('EVENT: onspeechstart - Speech detected.');
            recognition.onspeechend = () => log('EVENT: onspeechend - Speech finished.');
            recognition.onresult = (event) => {
                let transcript = event.results[event.resultIndex][0].transcript;
                log(`EVENT: onresult - Transcript: ${transcript}`);
                resultP.textContent = transcript;
            };

        } else {
            log('SpeechRecognition API NOT available.');
            micBtn.disabled = true;
            resultP.textContent = 'ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        }
    </script>
</body>
</html>